---
title: TCP服务器项目小结
abbrlink: 2709485540
date: 2020-06-13 11:52:10
tags:
---
服务器项目从开始写到现在已经过去两个月，由于工作忙，实现的内容并不多。在此总结一下，也规划下接下来的目标。项目地址 [github](https://github.com/mequanwei/wServer)。
<!--more-->
## 整体描述
tcp 服务器的功能是收到客户端发送请求之后，将客户端携带的信息和对应ID写入到数据库并返回ok。如果数据库中已有用户id，就更新对应的信息。用到的技术有 epoll 复用，多线程编程，线程池和数据库连接池等。
通过 Jmeter 进行压力测试，在 7s 内处理 8000 并发。超过之后会有部分丢包。

## 耗时较多的问题
1. 惊群现象。
这个问题在上篇文章详细描述了。
2. epoll size过小。
刚开始创建的 epoll_size 很小，所以压测基本在 QPS 200 左右就要挂。调整大小为 10000 之后，性能明显提升。

## 接下来的打算
1. 用 c++11 原生语法实现线程和锁。
2. 尝试使用 libevent 重构。
3. 增加日志系统。
